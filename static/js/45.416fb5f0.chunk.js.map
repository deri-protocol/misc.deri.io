{"version":3,"sources":["utils/graph_api.js","pages/Governance/DipTwelve.js"],"names":["graphQLClient","GraphQLClient","require","graph_request_test","mutation","variables","request","inject","observer","lang","wallet","useWallet","useState","value","setValue","optionInfo","setOptionInfo","isGetLtokenId","setIsGetLtokenId","sumPower","setSumPower","deadline","setDeadline","disabled","setDisabled","isOptioned","setIsOptioned","votingPower","setVotingPower","useVotingPower","setUseVotingPower","timeAgo","setTimeAgo","timeOut","setTimeOut","ArbUniDeri","setArbUniDeri","isTimeOut","setIsTimeOut","alert","useAlert","NFTContract","useContract","deriLtokenId","setDeriLtokenId","BTokenContract","PairContract","PoolContract","selectOption","useCallback","radioI","document","getElementById","radioII","radioIII","radioIV","radioVI","click","getUserVotingPower","ApiProxy","account","res","getUserVotingResult","console","log","option","getArbUniDeri","balanceOf","NFTNumber","BigNumber","from","_hex","toString","tokenId","index","tokenOfOwnerByIndex","id","push","deriTokenId","length","getPositionInfo","toLocaleLowerCase","data","map","item","obj","positions","tickLower","tickUpper","liquidity","Promise","all","slot0","tickCurrent","tick","amount","getAmountETHAndDeri","total_amount0","total_amount1","deri","eth","deriSum","reduce","accumulator","currentValue","getVotingResult","axios","get","JSON","parse","votes","timeNow","Date","MinNow","getMinutes","hoverNow","getHours","stemp","timestamp","MinAgo","hoverAgo","timeHover","timeMin","minTime","Number","bg","div","toNumber","findMaxMinSumIndex","max","min","sum","maxIndex","getV4LtokenId","query","gql","chainId","lpStates","find","bToken","lTokenId","getVotingInfo","time","i","defaultTime","maxObj","currentObj","getTime","vote","includeResponse","success","error","useEffect","isConnected","plus","className","to","alt","src","backIcon","timeDateFormat","calculateTimeDifference","onClick","e","type","name","onChange","event","checked","for","toFixed","style","width","decimalScale","label","fontSize","rel","target","href"],"mappings":"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","file":"static/js/45.416fb5f0.chunk.js","sourcesContent":["const {GraphQLClient } = require('graphql-request')\r\nconst graphQLClient = new GraphQLClient(\"https://v4dh.deri.io/graphql\", {})\r\nexport function graph_request_test(mutation,variables) {\r\n    return graphQLClient.request(mutation,variables)\r\n}","import './dip.less'\r\nimport { Link } from 'react-router-dom'\r\nimport { inject, observer } from 'mobx-react'\r\nimport React, { useState, useEffect } from 'react'\r\nimport Button from '../../components/Button/Button'\r\nimport { useAlert } from 'react-alert'\r\nimport DeriNumberFormat from '../../utils/DeriNumberFormat'\r\nimport ApiProxy from '../../model/ApiProxy'\r\nimport backIcon from '../../assets/img/back.svg'\r\nimport axios from 'axios'\r\nimport { bg, calculateTimeDifference, findMaxMinSumIndex, getAmountETHAndDeri, timeDateFormat } from '../../utils/utils'\r\nimport { useCallback } from 'react'\r\nimport useContract from '../../hooks/useContractLp'\r\nimport { BigNumber } from 'ethers'\r\nimport { graph_request_test } from '../../utils/graph_api'\r\nimport { gql } from 'graphql-request'\r\nimport { useWallet } from 'use-wallet'\r\n\r\nfunction DipTwelve({ lang }) {\r\n  const wallet = useWallet();\r\n  const [value, setValue] = useState()\r\n  const [optionInfo, setOptionInfo] = useState([])\r\n  const [isGetLtokenId, setIsGetLtokenId] = useState(false)\r\n  const [sumPower, setSumPower] = useState(0)\r\n  const [deadline, setDeadline] = useState(false)\r\n  const [disabled, setDisabled] = useState(true)\r\n  const [isOptioned, setIsOptioned] = useState(false)\r\n  const [votingPower, setVotingPower] = useState(0)\r\n  const [useVotingPower, setUseVotingPower] = useState(0)\r\n  const [timeAgo, setTimeAgo] = useState(\"\")\r\n  const [timeOut, setTimeOut] = useState(1701684900000)\r\n  const [ArbUniDeri, setArbUniDeri] = useState(0)\r\n  const [isTimeOut, setIsTimeOut] = useState(false)\r\n  const alert = useAlert();\r\n  const NFTContract = useContract(\"IERC721\", 42161)\r\n  const [deriLtokenId, setDeriLtokenId] = useState(0)\r\n  const BTokenContract = useContract(\"LpTokenId\", 42161)\r\n  const PairContract = useContract(\"PairAbi\", 42161)\r\n  const PoolContract = useContract(\"arbitrumLp\", 42161)\r\n\r\n  const PairAddress = \"0x96C3966534b4377691e11e163A0409Ad01667343\"\r\n  const arbitrumDeriAddress = \"0x21e60ee73f17ac0a411ae5d690f908c3ed66fe12\"\r\n\r\n  const selectOption = useCallback((value) => {\r\n    if (!isOptioned) {\r\n      let radioI = document.getElementById(\"I\")\r\n      let radioII = document.getElementById(\"II\")\r\n      let radioIII = document.getElementById(\"III\")\r\n      let radioIV = document.getElementById(\"IV\")\r\n      let radioVI = document.getElementById(\"VI\")\r\n      if (value === \"1\") {\r\n        radioI.click()\r\n      } else if (value === \"2\") {\r\n        radioII.click()\r\n      } else if (value === \"3\") {\r\n        radioIII.click()\r\n      } else if (value === \"4\") {\r\n        radioIV.click()\r\n      } else if (value === \"5\") {\r\n        radioVI.click()\r\n      }\r\n      setValue(value)\r\n    }\r\n\r\n  }, [isOptioned])\r\n  const getUserVotingPower = useCallback(async () => {\r\n    let res = await ApiProxy.request(\"getUserVotingPower\", [wallet.account, deriLtokenId || 0])\r\n    setVotingPower(res)\r\n  }, [wallet.account, deriLtokenId])\r\n  const getUserVotingResult = useCallback(async () => {\r\n    let res = await ApiProxy.request(\"getUserVotingResult\", [wallet.account, deriLtokenId || 0])\r\n    console.log(\"getUserVotingResult\", res)\r\n    if (res.option !== \"0\") {\r\n      setValue(res.option)\r\n      setIsOptioned(true)\r\n    } else {\r\n      setIsOptioned(false)\r\n    }\r\n  }, [wallet.account, deriLtokenId])\r\n\r\n  const getArbUniDeri = useCallback(async () => {\r\n    let NFTNumber = await NFTContract.balanceOf(wallet.account)\r\n    NFTNumber = BigNumber.from(NFTNumber._hex).toString()\r\n    let tokenId = []\r\n    for (let index = 0; index < NFTNumber; index++) {\r\n      let id = await NFTContract.tokenOfOwnerByIndex(wallet.account, index)\r\n      id = BigNumber.from(id._hex).toString()\r\n      tokenId.push(id)\r\n    }\r\n    let deriTokenId = [];\r\n    for (let index = 0; index < tokenId.length; index++) {\r\n      let id = await PoolContract.getPositionInfo(tokenId[index])\r\n      if (id[0].toLocaleLowerCase() === PairAddress.toLocaleLowerCase()) {\r\n        deriTokenId.push(tokenId[index])\r\n      }\r\n    }\r\n    let data = deriTokenId.map(async (item) => {\r\n      let obj = {}\r\n      let res = await BTokenContract.positions(item)\r\n      obj = {\r\n        tickLower: res.tickLower,\r\n        tickUpper: res.tickUpper,\r\n        liquidity: BigNumber.from(res.liquidity._hex).toString()\r\n      }\r\n      return obj\r\n    })\r\n    data = await Promise.all(data)\r\n    let tickCurrent = await PairContract.slot0()\r\n    tickCurrent = tickCurrent.tick\r\n    let amount = data.map((item) => {\r\n      let [total_amount0, total_amount1] = getAmountETHAndDeri(tickCurrent, item.tickLower, item.tickUpper, item.liquidity)\r\n      return {\r\n        deri: total_amount0 / 10 ** 18,\r\n        eth: total_amount1 / 10 ** 18\r\n      }\r\n    })\r\n    let deriSum = amount.reduce((accumulator, currentValue) => {\r\n      return accumulator + currentValue.deri;\r\n    }, 0)\r\n    console.log(\"getArbUniDeri\", deriSum)\r\n    setArbUniDeri(deriSum)\r\n  }, [BTokenContract, PairContract, NFTContract, wallet.account, PoolContract])\r\n\r\n  const getVotingResult = async () => {\r\n    let res = await axios.get(\"https://vote.deri.io/get_voting_powers\")\r\n    console.log(\"getVotingResult\", JSON.parse(res.data[0].votes))\r\n    if (res.data && res.data[0].votes) {\r\n      let timeNow = new Date()\r\n      let MinNow = timeNow.getMinutes()\r\n      let hoverNow = timeNow.getHours()\r\n      let stemp = res.data[0].timestamp * 1000\r\n      let timeAgo = new Date(stemp)\r\n      let MinAgo = timeAgo.getMinutes()\r\n      let hoverAgo = timeAgo.getHours()\r\n      let timeMin = MinNow - MinAgo\r\n      let timeHover = hoverNow - hoverAgo\r\n      if (timeMin >= 1 && timeHover <= 0) {\r\n        setTimeAgo(timeMin)\r\n      } else if (timeHover > 0) {\r\n        let min = 60 - MinAgo;\r\n        let minTime = min + Number(MinNow);\r\n        setTimeAgo(minTime)\r\n      } else if (timeMin < 1) {\r\n        let text = 'less than 1'\r\n        setTimeAgo(text)\r\n      }\r\n      res = JSON.parse(res.data[0].votes)\r\n      res = res.map(item => {\r\n        return bg(item).div(10 ** 18).toNumber()\r\n      })\r\n      let { max, min, sum, maxIndex } = findMaxMinSumIndex(res)\r\n      setSumPower(sum)\r\n      setOptionInfo(res)\r\n    }\r\n  }\r\n\r\n  const getV4LtokenId = useCallback(async () => {\r\n    let query = gql`\r\n      query ($chainId: Int!, $account: String!) {\r\n        lpStates(where: { chainId: $chainId, account: $account }) {\r\n          account\r\n          b0Amount\r\n          bAmount\r\n          bToken\r\n          cumulativePnl\r\n          cumulativePnlPerLiquidity\r\n          cumulativeTime\r\n          lTokenId\r\n          lastCumulativePnlOnEngine\r\n          lastCumulativeTimePerLiquidity\r\n          liquidity\r\n        }\r\n      }\r\n    `;\r\n    let variables = {\r\n      account: wallet.account,\r\n      chainId: 42161,\r\n    };\r\n    let data = await graph_request_test(query, variables);\r\n    console.log(data)\r\n    if (data && data.lpStates.length > 0) {\r\n      let deriLtokenId = data.lpStates.find(item => item.bToken.toLocaleLowerCase() === arbitrumDeriAddress.toLocaleLowerCase())\r\n      if (deriLtokenId) {\r\n        setDeriLtokenId(deriLtokenId.lTokenId)\r\n      }\r\n    }\r\n    setIsGetLtokenId(true)\r\n  }, [wallet.account])\r\n\r\n  const getVotingInfo = async () => {\r\n    let res = await ApiProxy.request(\"getVotingInfo\")\r\n    console.log(\"getVotingInfo\", res)\r\n    if (res && res.length) {\r\n      let time = res.find(i => +i.chainId === +wallet.chainId)\r\n      let defaultTime = res.reduce((maxObj, currentObj) => {\r\n        if (currentObj.deadline > maxObj.deadline) {\r\n          return currentObj;\r\n        }\r\n        return maxObj;\r\n      }, res[0]);\r\n      time = time ? time.deadline + \"000\" : defaultTime.deadline + \"000\"\r\n      let timestamp = new Date()\r\n      setTimeOut(+time)\r\n      if (timestamp.getTime() >= +time) {\r\n        setDeadline(true)\r\n        setIsTimeOut(true)\r\n      } else {\r\n        setIsTimeOut(false)\r\n        setDeadline(false)\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  const vote = async () => {\r\n    console.log([wallet.chainId, wallet.account, value])\r\n    let res = await ApiProxy.request(\"vote\", [wallet.chainId, wallet.account, value], { includeResponse: true })\r\n    if (res.success) {\r\n      getUserVotingPower()\r\n      getUserVotingResult()\r\n      getVotingResult()\r\n      alert.success(\"Success\")\r\n    } else {\r\n      alert.error(\"Failed\")\r\n    }\r\n\r\n  }\r\n  useEffect(() => {\r\n    if (wallet.isConnected() && isGetLtokenId) {\r\n      getUserVotingPower()\r\n      getUserVotingResult()\r\n      getVotingInfo()\r\n    }\r\n  }, [wallet, deriLtokenId, isGetLtokenId])\r\n  useEffect(() => {\r\n    getVotingResult()\r\n  }, [])\r\n  useEffect(() => {\r\n    if (wallet.isConnected() && value && !isOptioned && !deadline) {\r\n      setDisabled(false)\r\n    } else {\r\n      setDisabled(true)\r\n    }\r\n  }, [wallet, value, optionInfo, isOptioned])\r\n\r\n  useEffect(() => {\r\n    let sum = 0\r\n    if (ArbUniDeri && votingPower) {\r\n      sum = bg(ArbUniDeri).plus(votingPower).toNumber()\r\n    } else if (votingPower) {\r\n      sum = votingPower\r\n    } else if (ArbUniDeri) {\r\n      sum = ArbUniDeri\r\n    }\r\n    setUseVotingPower(sum)\r\n  }, [ArbUniDeri, votingPower])\r\n\r\n  useEffect(() => {\r\n    if (wallet.account) {\r\n      getV4LtokenId()\r\n    }\r\n  }, [wallet.account])\r\n\r\n  useEffect(() => {\r\n    if (NFTContract && wallet.account && PoolContract && BTokenContract && PairContract) {\r\n      getArbUniDeri()\r\n    }\r\n  }, [NFTContract, wallet.account, PoolContract, BTokenContract, PairContract])\r\n  return (\r\n    <div className='dip-box'>\r\n      <div className='back-governance'>\r\n        <Link to='/governance'>\r\n          <div className='icon-back'>\r\n            <img alt='' src={backIcon} />\r\n            <span>{lang['back']}</span>\r\n          </div>\r\n        </Link>\r\n        <div className='poll-detail'>\r\n          {lang['poll-detail']}\r\n        </div>\r\n      </div>\r\n      <div className='dip-box-info'>\r\n        <div className='poll-dip-info '>\r\n          <div className='dip-list-title'>\r\n            <div className='title-text'>\r\n              {lang['dip']}-011\r\n            </div>\r\n\r\n            <div className='dip-progress'>\r\n              <div className='progress-bg'></div>\r\n              PROGRESSING\r\n              {/* <div className='executed-bg'></div> FINISHED */}\r\n            </div>\r\n          </div>\r\n          <div className='dip-list-des '>\r\n            Vote for the next iChain for Deri V4\r\n          </div>\r\n          <div className='dip-time'>\r\n            {timeOut ?\r\n              isTimeOut ? `Target End Time:${timeDateFormat(timeOut)} (subject to extension, see below for details)` : <>\r\n                {calculateTimeDifference(timeOut)}\r\n                {\" \"}(Voting deadline: {timeDateFormat(timeOut)})\r\n              </> : `Voting deadline: ${timeDateFormat(timeOut)}`}\r\n            {/* Target End Time: 2023 Dec 4th 10:00:00AM UTC (subject to extension, see below for details) */}\r\n          </div>\r\n        </div>\r\n        <div className='dip-option'>\r\n          <div className={value === \"1\" ? \"option-check option-checked\" : \"option-check\"} onClick={(e) => selectOption(\"1\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='1'\r\n                  id=\"I\"\r\n                  onChange={event => selectOption(\"1\")}\r\n                  checked={value === \"1\"}\r\n                />\r\n                <label for=\"I\"></label>\r\n                <span className='option-title-text'>\r\n                  Base\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                {/* 333671   {lang['deri-voting']} (5%) */}\r\n                {optionInfo[0] ? optionInfo[0].toFixed(0) : 0} {lang['deri-voting']} ({sumPower && optionInfo[0] ? ((optionInfo[0] / sumPower) * 100).toFixed(0) : 0}%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg' style={{ width: `${sumPower && optionInfo[0] ? ((optionInfo[0] / sumPower) * 100).toFixed(0) : 0}%` }}></div>\r\n            {/* <div className='option-peng-bg' style={{ width: `5%` }}></div> */}\r\n          </div>\r\n          <div className={value === \"2\" ? \"option-check option-checked\" : \"option-check\"} onClick={() => selectOption(\"2\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='2'\r\n                  id=\"II\"\r\n                  onChange={event => selectOption(\"2\")}\r\n                  checked={value === \"2\"}\r\n                />\r\n                <label for=\"II\"></label>\r\n                <span className='option-title-text'>\r\n                  Blast\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                {/* 2065635 {lang['deri-voting']} (30%) */}\r\n                {optionInfo[1] ? optionInfo[1].toFixed(0) : 0}  {lang['deri-voting']} ({sumPower && optionInfo[1] ? ((optionInfo[1] / sumPower) * 100).toFixed(0) : 0}%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg ' style={{ width: `${sumPower && optionInfo[1] ? ((optionInfo[1] / sumPower) * 100).toFixed(0) : 0}%` }}></div>\r\n            {/* <div className='option-peng-bg ' style={{ width: `30%` }}></div> */}\r\n          </div>\r\n          <div className={value === \"3\" ? \"option-check option-checked\" : \"option-check\"} onClick={() => selectOption(\"3\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='3'\r\n                  id=\"III\"\r\n                  onChange={event => selectOption(\"3\")}\r\n                  checked={value === \"3\"}\r\n                />\r\n                <label for=\"III\"></label>\r\n                <span className='option-title-text'>\r\n                  BNBChain\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                {/* 4478611  {lang['deri-voting']} (65%) */}\r\n                {optionInfo[2] ? optionInfo[2].toFixed(0) : 0}  {lang['deri-voting']} ({sumPower && optionInfo[2] ? ((optionInfo[2] / sumPower) * 100).toFixed(0) : 0}%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg ' style={{ width: `${sumPower && optionInfo[2] ? ((optionInfo[2] / sumPower) * 100).toFixed(0) : 0}%` }}></div>\r\n            {/* <div className='option-peng-bg ' style={{ width: `65%` }}></div> */}\r\n          </div>\r\n          <div className={value === \"4\" ? \"option-check option-checked\" : \"option-check\"} onClick={() => selectOption(\"4\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='4'\r\n                  id=\"IV\"\r\n                  onChange={event => selectOption(\"4\")}\r\n                  checked={value === \"4\"}\r\n                />\r\n                <label for=\"IV\"></label>\r\n                <span className='option-title-text'>\r\n                  Merlin Chain\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                {/* 0 {lang['deri-voting']} (0%) */}\r\n                {optionInfo[3] ? optionInfo[3].toFixed(0) : 0}  {lang['deri-voting']} ({sumPower && optionInfo[3] ? ((optionInfo[3] / sumPower) * 100).toFixed(0) : 0}%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg ' style={{ width: `${sumPower && optionInfo[3] ? ((optionInfo[3] / sumPower) * 100).toFixed(0) : 0}%` }}></div>\r\n            {/* <div className='option-peng-bg ' style={{ width: `0%` }}></div> */}\r\n          </div>\r\n          <div className={value === \"5\" ? \"option-check option-checked\" : \"option-check\"} onClick={() => selectOption(\"5\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='5'\r\n                  id=\"VI\"\r\n                  onChange={event => selectOption(\"5\")}\r\n                  checked={value === \"5\"}\r\n                />\r\n                <label for=\"VI\"></label>\r\n                <span className='option-title-text'>\r\n                  opBNB\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                {/* 14158 {lang['deri-voting']} (0%) */}\r\n                {optionInfo[4] ? optionInfo[4].toFixed(0) : 0}  {lang['deri-voting']} ({sumPower && optionInfo[4] ? ((optionInfo[4] / sumPower) * 100).toFixed(0) : 0}%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg ' style={{ width: `${sumPower && optionInfo[4] ? ((optionInfo[4] / sumPower) * 100).toFixed(0) : 0}%` }}></div>\r\n          </div>\r\n          <div className='power-time'>\r\n            Last updated: {timeAgo} minutes ago\r\n          </div>\r\n          <div className='vote-button'>\r\n            <div className='your-power'>\r\n              Your Voting Power :\r\n              <DeriNumberFormat value={useVotingPower} decimalScale={2} /> DERI\r\n            </div>\r\n            <Button disabled={disabled} label={isOptioned ? `Vote Submitted` : lang['vote']} onClick={vote} width='286' fontSize='18' />\r\n            {/* <Button disabled={true} label={lang['vote']} onClick={vote} width='286' fontSize='18' /> */}\r\n          </div>\r\n        </div>\r\n        <div className='dip-option-des-rules'>\r\n          <div className='description-close-open'>\r\n            {lang['description']}\r\n          </div>\r\n          <div className='description-text'>\r\n            <div className='ul-description'>\r\n              The “iChain”, one of the two main components of Deri V4, represents the requesting interface and serves as a pivotal entry point for user interactions. It adeptly handles all the user requests, from traders initiating orders and managing margins to liquidity providers adding or removing liquidity. While theoretically any layer 1 or layer 2 can be adopted as an i-Chain, in practice, the community will choose which ones to deploy.\r\n            </div>\r\n          </div>\r\n\r\n          <div className='vote-rules'>\r\n            <div className='rules-title'>\r\n              {lang['voting-rules']}\r\n            </div>\r\n            <div className='rules-text'>\r\n              <div className='rules-margin'>\r\n                Your voting power is the summation of the following balances in your wallet as of the deadline:\r\n                <ul className='no-margin'>\r\n                  <li>DERI balance in your wallet</li>\r\n                  <li>DERI balance in your LP tokens on Deri Pools</li>\r\n                  <li>DERI amount contained in your DERI-USDT SLP tokens on SushiSwap</li>\r\n                  <li>DERI amount contained in your DERI-BUSD CLP tokens on PancakeSwap</li>\r\n                  <li>DERI amount contained in your DERI-WETH LP tokens on Uniswap V3</li>\r\n                </ul>\r\n              </div>\r\n              <div className='rules-margin'>\r\n                You can choose any of the 8 chains (ETH/Arbitrum/BNBChain/Linea/zkSync/Scroll/Polygon zkEVM/Manta Pacific) to sign your vote by the deadline\r\n              </div>\r\n              <div className='rules-margin'>\r\n                Voting Deadline = {timeDateFormat(timeOut)}\r\n              </div>\r\n              <div className='rules-margin'>\r\n                When a vote is submitted less than 15 min to the deadline, the deadline will be extended by 15 min. That is, the voting period will continue to extend until there is no vote within the last 15 min.\r\n              </div>\r\n              <div className='rules-margin'>\r\n                A snapshot will be taken at the block, at the deadline, and used to calculate the result.\r\n              </div>\r\n              <div className='rules-margin'>\r\n                Please note that, if you had voted before the deadline but then had transferred your DERI, DLT, SushiSwap-LP, Pancake-LP, or Uniswap-LP before the deadline, it would be the balance at the deadline that counts\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className='supplementary-notes'>\r\n            <div className='notes-title'>\r\n              Reference Poll Link\r\n            </div>\r\n            <div className='notes-text'>\r\n              <a rel=\"noreferrer\" target=\"_blank\" href=\"https://snapshot.org/#/deri.eth/proposal/0x97a430dc74bf4ac7adbfd38c6b2806a5dd1ee4253e5b659dc078cff11aa4d3e7\">Snapshot</a>\r\n            </div>\r\n          </div>\r\n          <div className='supplementary-notes'>\r\n            <div className='notes-title'>\r\n              Discussion\r\n            </div>\r\n            <div className='notes-text'>\r\n              <a rel=\"noreferrer\" target=\"_blank\" href=\"https://discord.com/invite/kb8ZbYgp8M\">Discord</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\nexport default inject('wallet')(observer(DipTwelve))\r\n\r\n\r\n"],"sourceRoot":""}
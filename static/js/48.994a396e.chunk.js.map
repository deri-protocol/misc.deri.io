{"version":3,"sources":["pages/Governance/DipFour.js"],"names":["inject","observer","wallet","lang","useState","value","setValue","optionInfo","setOptionInfo","setSumPower","setWinner","deadline","setDeadline","setDisabled","isOptioned","setIsOptioned","setVotingPower","alert","useAlert","selectOption","radioI","document","getElementById","radioII","click","getUserVotingPower","ApiProxy","request","detail","account","res","getUserVotingResult","console","log","option","getVotingResult","sum","option_1","option_2","winnerPower","getVotingInfo","time","find","i","chainId","timestamp","Date","getTime","vote","includeResponse","success","error","useEffect","isConnected","className","to","alt","src","backIcon","onClick","e","type","name","id","checked","for","style","width","disabled","label","fontSize","target","href","rel"],"mappings":"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","file":"static/js/48.994a396e.chunk.js","sourcesContent":["import './dip.less'\r\nimport { Link } from 'react-router-dom'\r\nimport { inject, observer } from 'mobx-react'\r\nimport React, { useState, useEffect } from 'react'\r\nimport Button from '../../components/Button/Button'\r\nimport { useAlert } from 'react-alert'\r\nimport DeriNumberFormat from '../../utils/DeriNumberFormat'\r\nimport ApiProxy from '../../model/ApiProxy'\r\nimport backIcon from '../../assets/img/back.svg'\r\nfunction DipFour({ wallet, lang }) {\r\n  const [value, setValue] = useState()\r\n  const [optionInfo, setOptionInfo] = useState()\r\n  const [sumPower, setSumPower] = useState(0)\r\n  const [winner, setWinner] = useState()\r\n  const [deadline, setDeadline] = useState(false)\r\n  const [disabled, setDisabled] = useState(true)\r\n  const [isOptioned, setIsOptioned] = useState(true)\r\n  const [votingPower, setVotingPower] = useState()\r\n  const alert = useAlert();\r\n  const selectOption = (value) => {\r\n    if (!isOptioned) {\r\n      let radioI = document.getElementById(\"I\")\r\n      let radioII = document.getElementById(\"II\")\r\n      if (value === \"1\") {\r\n        radioI.click()\r\n      } else {\r\n        radioII.click()\r\n      }\r\n      setValue(value)\r\n    }\r\n\r\n  }\r\n  const getUserVotingPower = async () => {\r\n    let res = await ApiProxy.request(\"getUserVotingPower\", [wallet.detail.account])\r\n    setVotingPower(res)\r\n  }\r\n  const getUserVotingResult = async () => {\r\n    let res = await ApiProxy.request(\"getUserVotingResult\", [wallet.detail.account])\r\n    console.log(\"getUserVotingResult\", res)\r\n    if (res.option !== \"0\") {\r\n      setValue(res.option)\r\n      setIsOptioned(true)\r\n    } else {\r\n      setIsOptioned(false)\r\n    }\r\n  }\r\n\r\n  const getVotingResult = async () => {\r\n    let res = await ApiProxy.request(\"getVotingResult\")\r\n    console.log(\"getVotingResult\", res)\r\n    let sum = (+res.option_1) + (+res.option_2)\r\n    let winnerPower = (+res.option_1) > (+res.option_2) ? \"1\" : \"2\"\r\n    setWinner(winnerPower)\r\n    setSumPower(sum)\r\n    setOptionInfo(res)\r\n  }\r\n\r\n  const getVotingInfo = async () => {\r\n    let res = await ApiProxy.request(\"getVotingInfo\")\r\n    let time = res.find(i => +i.chainId === +wallet.detail.chainId)\r\n    time = time.deadline + \"000\"\r\n    let timestamp = new Date()\r\n    if (timestamp.getTime() >= +time) {\r\n      setDeadline(true)\r\n    } else {\r\n      setDeadline(false)\r\n    }\r\n    console.log(\"getVotingInfo\", timestamp.getTime() >= +time)\r\n\r\n  }\r\n\r\n  const vote = async () => {\r\n    console.log([wallet.detail.chainId, wallet.detail.account, value])\r\n    let res = await ApiProxy.request(\"vote\", [wallet.detail.chainId, wallet.detail.account, value], { includeResponse: true })\r\n    if (res.success) {\r\n      getUserVotingPower()\r\n      getUserVotingResult()\r\n      getVotingResult()\r\n      alert.success(\"Success\")\r\n    } else {\r\n      alert.error(\"Failed\")\r\n    }\r\n\r\n  }\r\n  useEffect(() => {\r\n    if (wallet.isConnected()) {\r\n      getUserVotingPower()\r\n      // getUserVotingResult()\r\n      getVotingInfo()\r\n    }\r\n  }, [wallet, wallet.detail])\r\n  useEffect(() => {\r\n    getVotingResult()\r\n  }, [])\r\n  useEffect(() => {\r\n    if (wallet.isConnected() && value && !isOptioned && !deadline) {\r\n      setDisabled(false)\r\n    } else {\r\n      setDisabled(true)\r\n    }\r\n  }, [wallet.detail, value, optionInfo, isOptioned])\r\n  return (\r\n    <div className='dip-box'>\r\n      <div className='back-governance'>\r\n        <Link to='/governance'>\r\n          <div className='icon-back'>\r\n            <img alt='' src={backIcon} />\r\n            <span>{lang['back']}</span>\r\n          </div>\r\n        </Link>\r\n        <div className='poll-detail'>\r\n          {lang['poll-detail']}\r\n        </div>\r\n      </div>\r\n      <div className='dip-box-info'>\r\n        <div className='poll-dip-info'>\r\n          <div className='dip-list-title'>\r\n            <div className='title-text'>\r\n              {lang['dip']}-004\r\n            </div>\r\n            <div className='dip-progress'>\r\n              <div className='executed-bg'></div>\r\n              FINISHED\r\n            </div>\r\n          </div>\r\n          <div className='dip-list-des'>\r\n            Revote for changing the DERI burning mechanism\r\n          </div>\r\n          <div className='dip-time'>\r\n            Target End Time: 2022 Sat. 4th June 4:00 AM UTC (subject to extension, see below for details)\r\n          </div>\r\n        </div>\r\n        <div className='dip-option'>\r\n          <div className={value === \"1\" ? \"option-check option-checked\" : \"option-check\"} onClick={(e) => selectOption(\"1\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='1'\r\n                  id=\"I\"\r\n                  // onChange={event => selectOption(\"1\")}\r\n                  checked={value === \"1\"}\r\n                />\r\n                <label for=\"I\"></label>\r\n                <span className='option-title-text'>\r\n                  Burn to deadlock address\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                2997820 {lang['deri-voting']} (87%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg' style={{ width: `87%` }}></div>\r\n          </div>\r\n          <div className={value === \"2\" ? \"option-check option-checked\" : \"option-check\"} onClick={() => selectOption(\"2\")} >\r\n            <div className='dip-one-option-title option-title'>\r\n              <div className='option-check-text'>\r\n                <input\r\n                  type='radio'\r\n                  name='option'\r\n                  value='2'\r\n                  id=\"II\"\r\n                  // onChange={event => selectOption(\"2\")}\r\n                  checked={value === \"2\"}\r\n                />\r\n                <label for=\"II\"></label>\r\n                <span className='option-title-text'>\r\n                  Burn to mining vault (the status quo)\r\n                </span>\r\n              </div>\r\n              <div className='option-num'>\r\n                428618 {lang['deri-voting']} (13%)\r\n              </div>\r\n            </div>\r\n            <div className='option-peng-bg ' style={{ width: `13%` }}></div>\r\n          </div>\r\n          <div className='vote-button'>\r\n            <div className='your-power'>\r\n              {/* Your Voting Power :\r\n              <DeriNumberFormat value={votingPower} decimalScale={2} /> DERI */}\r\n            </div>\r\n            <Button disabled={true} label={lang['vote']} onClick={vote} width='286' fontSize='18' />\r\n          </div>\r\n        </div>\r\n        <div className='dip-option-des-rules'>\r\n          <div className='description-close-open'>\r\n            {lang['description']}\r\n          </div>\r\n          <div className='description-text'>\r\n            <div className='ul-description'>\r\n              Based on the community poll on snapshot proposed by a community member, the Deri team has placed an executive proposal (DIP 4) into the governance voting system. DERI Holders should vote for this proposal if they want to change the current DERI burning mechanism.\r\n              <br></br>\r\n              The option one proposes to burn to deadlock address, thus removing DERI from circulation forever.\r\n              <br></br>\r\n              The option two is the status quo, which is that DERI bought from the secondary market is sent to the mining vault.\r\n              <a target=\"_blank\" href=\"https://docs.deri.io/library/tokenomics#burning-mechanism\">Read more.</a>\r\n            </div>\r\n          </div>\r\n\r\n          <div className='vote-rules'>\r\n            <div className='rules-title'>\r\n              {lang['voting-rules']}\r\n            </div>\r\n            <div className='rules-text'>\r\n              <div className='rules-margin'>\r\n                Your voting power is the summation of the following balances in your wallet as of the deadline:\r\n                <ul className='no-margin'>\r\n                  <li>DERI balance</li>\r\n                  <li>the corresponding DERI amount of your DERI-USDT SLP balance on SushiSwap</li>\r\n                  <li>the corresponding DERI amount of your DERI-BUSD CLP balance on PancakeSwap</li>\r\n                  <li>the corresponding DERI amount of your DLT balance in the DERI-based Inno Zone pools (BNB Chain)</li>\r\n                </ul>\r\n              </div>\r\n              <div className='rules-margin'>\r\n                You can choose any of the 3 chains (ETH/BNB Chain/Aribitrum) to sign your vote by the deadline\r\n              </div>\r\n              <div className='rules-margin'>\r\n                Voting Deadline: targeted at 2022 Sat. 4th June 4:00 AM UTC.  When a vote is submitted less than 15 min to the deadline, the deadline will be extended by 15 min. That is, the voting period will continue to extend until there is no vote within the last 15 min.\r\n              </div>\r\n              <div className='rules-margin'>\r\n                A snapshot will be taken at the block, at the deadline, and used to calculate the result. Please note that, if you had voted before the deadline but then had transferred your DERI, SLP, PANCAKE-LP, or DLT before the deadline, it would be the balance at the deadline that counts.\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className='supplementary-notes'>\r\n            <div className='notes-title'>\r\n              Reference Poll Link\r\n            </div>\r\n            <div className='notes-text'>\r\n              <a target=\"_blank\" href=\"https://snapshot.org/#/deri.eth/proposal/0x7671323ba773ebc9043e339abb50faef5655597342aef1cbe23a7e9be85fd3bb\" rel=\"noreferrer\">Snapshot</a>\r\n            </div>\r\n          </div>\r\n          <div className='supplementary-notes'>\r\n            <div className='notes-title'>\r\n              Discussion\r\n            </div>\r\n            <div className='notes-text'>\r\n              <a rel=\"noreferrer\" target=\"_blank\" href=\"https://discord.com/invite/kb8ZbYgp8M\">Discord</a>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\nexport default inject('wallet')(observer(DipFour))\r\n\r\n\r\n"],"sourceRoot":""}